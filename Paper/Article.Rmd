---
title: "Just Take the Bus: Analysis of Toronto Bike Theft from 2022-2024"
subtitle: tbd
author:
- Rayan Awad Alim
- Samreen Gill
thanks: https://github.com/RayanAlim/Toronto_Bike_Thefts_Data_Analysis
date: "November 12, 2024"
abstract: This analysis examines Bike theft data obtained from the Tronrot Police Data Portal.
output: pdf_document
toc: true
number-sections: true
editor_options:
  markdown:
    wrap: 72
---

```{r setup}
#| include: false
#| warning: false
#| message: false
# Workspace Set up 

knitr::opts_chunk$set(echo=FALSE, include=TRUE, eval=TRUE)
required_packages <- c(
  "lubridate", "sf", "tidyverse", "ggplot2", "maps", "dplyr", "sf", "mapdata", "ggspatial", "opendatatoronto", "here"
) 
for (p in required_packages) { # install if missing
  if (!require(p, character.only = TRUE)) {
    install.packages(p, character.only = TRUE)
  }
}

library(ggplot2)
library(dplyr)
library(tidyverse)
library(sf)
library(mapdata)
library(ggspatial)
library(opendatatoronto)
library(here)
```

```{r}
#| include: false
#| warning: false
#| message: false
# you are welcome to use either the CSV file or the GeoJSON file
# GeoJSON format maybe useful if you would like to combine
# an external geospatial dataset

bike_thefts <- read_csv(here("Data", "Bike_thefts_raw.csv")) |>
  mutate(
    occurence_date = as_date(
      OCC_DATE, format = "%a, %d %b %Y %H:%M:%S GMT"
    ),
    report_date = as_date(
      REPORT_DATE, format = "%a, %d %b %Y %H:%M:%S GMT"
    )
  )
bike_thefts_sf <- read_sf(here("Data", "Bicycle_Thefts_Open_Data.geojson")) |>
  mutate(
    occurence_date = as_date(
      OCC_DATE, format = "%a, %d %b %Y %H:%M:%S GMT"
    ),
    report_date = as_date(
      REPORT_DATE, format = "%a, %d %b %Y %H:%M:%S GMT"
    )
  )
```

```{r}
#| include: false
#| warning: false
#| message: false
#glimpse(bike_thefts)
```

Many cities are promoting bicycles to reduce reliance on cars,
recognizing significant benefits cycling brings to the environment,
public health and economy. As cyclists continue to gain popularity in
Toronto, bicycle theft has emerged as a growing concern leaving many
feeling vulnerable. With the increasing number of cyclists on the road,
knowing when and where bike thefts are most likely to occur is crucial
for protecting valuable bicycles. This analysis aims to inform the
general public and cyclists about neighborhoods with the highest rate of
thefts and times when their bikes are most likely to be stolen. This
would not only raise awareness but also help people make more informed
decisions to secure their bikes, ultimately reducing the risk of theft
and fostering a safer cycling environment in Toronto. 

**Top 10  neighborhoods that  contribute to the most number of bicycle
thefts across Toronto ?**

We can see the worst neighborhood for bike thefts in Toronto is
Yonge-Bay Corridor followed by Downtown Yonge East and St Lawrence East
Bayfront, with each exceeding 1000 incidents from 2022 to 2024. In the
past three years, about 5100 bikes were reported stolen from these
areas. These neighborhoods contribute to approximately 17% of total
bicycle thefts reported across Toronto. This high concentration reflects
a combination of factors such as lack of secure bike storage, crowded
public spaces making these areas prime targets for thieves. 

How much do they contribute to total theft from 2022 to 2024 ? \
(Comparing with premise type)An in-depth analysis of premise type
unfolds that bicycles last parked outside building premises, whether
residential or commercial are particularly vulnerable to theft. This
trend is consistently observed in top 10 neighborhoods for bike theft.
These locations, especially because of high foot or bike traffic,
provide easy access and quick escape routes for criminals.

\

**When is your bike most likely to be stolen(day of the week, month) ?**

\

Based on the figures below, it is pretty evident the highest frequency
of bicycle thefts occurs during July and August. This aligns with the
warmer summer months when more people tend to ride bicycles, increasing
both bicycles in public spaces and likelihood of theft. Thefts begin to
build up during spring, peaking in summer, followed by a steady decline
through fall and winter. The data suggests thefts are more common during
weekdays, potentially because most people use bicycles to commute to
work or school. Bicycles parked during weekdays are often unattended for
several hours, providing thieves with ample time to steal them. 

Additionally, the majority of bicycles get stolen during the night than
in morning, afternoon or evening.

```{r}
#BY MONTH
bike_thefts %>%
  count(OCC_MONTH) %>%
  ggplot(aes(x = reorder(OCC_MONTH, n), y = n, fill = OCC_MONTH)) +
  geom_bar(stat = "identity") +
  labs(title = "Bike Thefts by Month of the Year",
       x = "Month", y = "Number of Thefts") +
  theme_minimal() +
  scale_fill_brewer(palette = "Set3") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 
```

```{r}
# BY DAY OF WEEK
bike_thefts %>%
  count(OCC_DOW) %>%
  ggplot(aes(x = OCC_DOW, y = n, fill = OCC_DOW)) +
  geom_bar(stat = "identity") +
  labs(title = "Bike Thefts by Day of the Week",
       x = "Day of the Week", y = "Number of Thefts") +
  theme_minimal() +
  scale_fill_brewer(palette = "Set3")
```

```{r}
# heaatmap of thefts by day of week and hour

ggplot(bike_thefts, aes(x = OCC_DOW, y = OCC_HOUR)) +
  geom_bin2d(bins = 24) +
  scale_fill_gradient(low = "lightblue", high = "red") +
  labs(title = "Heatmap of Bike Thefts by Day and Hour", 
       x = "Day of Week", 
       y = "Hour of Day") +
  theme_minimal()
```

### Neighbourhood analysis and Maps

```{r}
#TOP TEN 
bike_thefts %>%
  count(NEIGHBOURHOOD_158) %>%
  slice_max(n, n = 10) %>%
  ggplot(aes(x = reorder(NEIGHBOURHOOD_158, n), y = n)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  coord_flip() +
  labs(title = "Top 10 Neighborhoods for Bike Thefts",
       x = "Neighborhood", y = "Number of Thefts") +
  theme_minimal()
```

```{r}
#| include: false
#| warning: false
#| message: false
#MAP TBD
#library(opendatatoronto)
```

### Bike Theft by Type and Cost

Here we com[are] the frequency of thefts by bike type and cost
distribution:

```{r}
# Barplot for bike types
ggplot(bike_thefts, aes(x = BIKE_TYPE)) +
  geom_bar(fill = "steelblue") +
  labs(title = "Number of Bike Thefts by Bike Type", x = "Bike Type", y = "Count") +
  theme_minimal()
```

```{r}
# Box plot for bike cost distribution by status
ggplot(bike_thefts %>% filter(!is.na(BIKE_COST)), aes(x = STATUS, y = BIKE_COST)) +
  geom_boxplot() +
  labs(title = "Bike Cost Distribution (Recovered vs Stolen)", x = "Status", y = "Cost ($)") +
  theme_minimal()
```

### Reporting Delays

Analyzing the time delay between theft occurrence and reporting date
(Not working, got to tweajk it some more)

```{r}
#| include: FALSE
#| warning: false
#| message: false
# calcuate reporting delay
bike_thefts <- bike_thefts %>%
  mutate(reporting_delay = as.numeric(difftime(ymd_hms(REPORT_DATE), ymd_hms(OCC_DATE), units = "days")))

ggplot(bike_thefts, aes(x = reporting_delay)) +
  geom_histogram(binwidth = 1, fill = "purple", color = "black") +
  labs(title = "Reporting Delays for Bike Thefts", x = "Days Delay", y = "Count") +
  theme_minimal()
```

### Theft Recovery Analysis by Neighborhood

which neighborhoods have higher recovery rates and analyzing the
recovered vs unrecovered bikes by neighborhood

```{r}
# calculating recovery rate by neighborhood
recovery_by_neighborhood <- bike_thefts %>%
  group_by(NEIGHBOURHOOD_158) %>%
  summarize(
    total_thefts = n(),
    recovered = sum(STATUS == "RECOVERED"),
    recovery_rate = recovered / total_thefts
  ) %>%
  slice_max(recovery_rate, n = 10) # Get top 10 neighborhoods by recovery rate

#  recovery rate by neighborhood
ggplot(recovery_by_neighborhood, aes(x = reorder(NEIGHBOURHOOD_158, recovery_rate), y = recovery_rate)) +
  geom_bar(stat = "identity", fill = "forestgreen") +
  coord_flip() +
  labs(title = "Top 10 Neighborhoods by Recovery Rate", x = "Neighborhood", y = "Recovery Rate") +
  theme_minimal()
```

```{r}
# map

# Count and filter top 10 neighborhoods with the highest thefts
top_neighborhoods <- bike_thefts %>%
  count(NEIGHBOURHOOD_158) %>%
  slice_max(n, n = 10)

# Treemap plot
treemap::treemap(
  top_neighborhoods,
  index = "NEIGHBOURHOOD_158",  # Using neighborhood names as the index
  vSize = "n",                  # Size by count of thefts
  vColor = "n",                 # Color by count of thefts
  palette = c("#2b5c8a", "goldenrod1", "#9e3d22"),
  type = "manual",
  align.labels = list(c("right", "top"), c("left", "bottom")),
  overlap.labels = 0.2,
  title = "Number of Bicycle Thefts by Neighborhood",
  fontsize.title = 18,
  title.legend = "Frequency",
  fontsize.labels = 10, 
)
```

```{r}
```

```{r}
```

```{r}
```

```{r}
```

```{r}
```

```{r}
```
